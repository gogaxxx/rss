#!/usr/bin/perl

use strict;

use Agg::Config;
use Agg::Download;
use Agg::Parser;

MAIN: {
	my $id = $ARGV[0];

	if (!defined($id) || $id eq '') {
		die("Specify id");
	}

	my $cfg = Agg::Config->get_config_by_id($id);
	print $cfg->{name}, ' ';
	my $loader = Agg::Download->new($cfg);
	$cfg->{'content'} = $loader->fetch_recent($cfg->{'url'});# XXX не засовывать в cfg!

	open(NEWS, '>'.$cfg->{'news'}) || die("Can't open $cfg->{news}:$!");
	close NEWS;

	my $parser = Agg::Parser->new($cfg);
	$parser->parse();
	print "\n";
}
