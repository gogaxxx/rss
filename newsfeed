#!/bin/sh

export ROOT=/home/nephrite/rss
export BIN=$ROOT/bin
MAXPROCESSES=5

#--------------------------------------
let N=$MAXPROCESSES-1

cd $ROOT/config

FROM=''
TO=''
while getopts f:t: OPT; do
	case $OPT in
		f) FROM="-f $OPTARG"
		;;
		t) TO="-t $OPTARG"
		;;
	esac
done

rm $ROOT/read/*
i=1
for feed in *
do
	if [ $feed != 'config' ]; then
		$BIN/do-feed $FROM $TO $feed &
	fi
	if [ $[$i % MAXPROCESSES ] = $N ]; then
		wait
	fi
	let i=$i+1
done

wait
echo All done
